<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>3D Drag MVP</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
<style>
html,body{margin:0;background:#111}
</style>
</head>
<body>
<script>
/* ===== parameters ===== */
const GRID = 5;
const CELL = 80;
const CUBE = CELL * 0.85;
const DRAG_THRESHOLD = 20;

/* ===== state ===== */
let cube = { x: 2, y: 2 };
let dragDX = 0, dragDY = 0;
let dragging = false;

/* ===== helpers ===== */
function inside(x,y){
  return x>=0 && x<GRID && y>=0 && y<GRID;
}

function world(x,y){
  const r = GRID * CELL / 2;
  return [-r + CELL/2 + x*CELL, -r + CELL/2 + y*CELL];
}

/* ===== p5 ===== */
new p5(p=>{
  p.setup = ()=>{
    p.createCanvas(window.innerWidth, window.innerHeight, p.WEBGL);
  };

  p.draw = ()=>{
    p.background(20);
    p.lights();

    /* grid */
    const r = GRID * CELL / 2;
    p.stroke(150);
    p.noFill();
    for(let i=0;i<=GRID;i++){
      const t = -r + i*CELL;
      p.line(t,-r,0,t,r,0);
      p.line(-r,t,0,r,t,0);
    }

    /* cube */
    const [cx,cy] = world(cube.x,cube.y);
    p.push();
    p.translate(cx,cy,CUBE/2);
    p.noStroke();
    p.fill(220);
    p.box(CUBE);
    p.pop();

    /* drag debug (screen space) */
    if(dragging){
      p.resetMatrix();
      p.translate(-p.width/2,-p.height/2);
      p.stroke(255);
      p.line(
        p.mouseX - dragDX,
        p.mouseY - dragDY,
        p.mouseX,
        p.mouseY
      );
    }
  };

  /* ===== drag handling ===== */
  p.mousePressed = ()=>{
    dragging = true;
    dragDX = dragDY = 0;
  };

  p.mouseDragged = ()=>{
    if(!dragging) return;
    dragDX += p.movedX;
    dragDY += p.movedY;
  };

  p.mouseReleased = ()=>{
    if(!dragging) return;
    dragging = false;

    if(Math.hypot(dragDX,dragDY) < DRAG_THRESHOLD) return;

    let dir =
      Math.abs(dragDX) > Math.abs(dragDY)
        ? (dragDX>0 ? "east" : "west")
        : (dragDY>0 ? "south" : "north");

    const nx = cube.x + (dir==="east") - (dir==="west");
    const ny = cube.y + (dir==="south") - (dir==="north");

    if(inside(nx,ny)){
      cube.x = nx;
      cube.y = ny;
    }
  };

  p.windowResized = ()=>{
    p.resizeCanvas(window.innerWidth, window.innerHeight);
  };
});
</script>
</body>
</html>